{% extends 'Shop_App/base.html' %}

{% block content %}
<div class="row">
    <div class="col-2 left-side-menu p-2">
        <h2 class="text-light text-center pt-2 pb-1">Categories</h2>
        <hr>
        <div id="food-cat-menu"></div>
    </div>

    <div class="col-8 main-content p-2">

      <h1 class="text-center pt-2 pb-2">Our Menu:</h1>
      <hr>
      <div id = "toGenerate" class="d-flex flex-row-reverse justify-content-around flex-wrap"></div> 

        <script>

          /* Function to generate categories */
          const generate_categories = (category_list) => {
            var generated_content = "";
            for(var i=0; i<category_list.length; i++){
              generated_content+= ` 
                <div class='row'>
                  <a class='btn btn-light mx-auto btncats' type='button' id=`+
                  category_list[i].category + "> "+
                category_list[i].category + "</a></div>";
            }
            return(generated_content);
          }

          /* Function to generate the menu list */
          const generate_menu_list = (product_list) => {
            var generated_content= "";

            var i;
            for(i=0; i<product_list.length; i++){              
              var menu_position = "";
              menu_position += `
            
              <div class="card mb-3" style="width: 400px;">
                <div class="row g-0">
                  <div class="col-md-5">
                    <img src="`+ product_list[i].image  +`" class="img-fluid rounded-start dish" alt="Dish image">
                  </div>
                  <div class="col-md-7">
                    <div class="card-body">
                      <h5 class="card-title">`+ product_list[i].name;
                      
              if(product_list[i].is_vege){menu_position += "<mark style='color: #007004'>(vege)</mark>";}
              menu_position += `
                      </h5>
                      <p class="card-text">`+ product_list[i].description +`</p>
                      <p class="card-text"><small class="text-muted">Date added:`+ product_list[i].creation_date +`</small></p>
                    </div>
                    `
              if(product_list[i].is_vege) menu_position += `<div class="card-footer vege-menu-bg">`
                else menu_position += `<div class="card-footer">`
                    
              menu_position +=`
                        <h5>Price: `+ product_list[i].price +` z≈Ç</h5>
                        <button class="btn btn-outline-success" type="button">Add to order</button>
                    </div>
                  </div>
                </div>
              </div>`;
              generated_content += menu_position;
            }

            document.getElementById("toGenerate").innerHTML = generated_content
            return(0);
          };

          const xhr = new XMLHttpRequest();
          const method = 'GET';
          const url = "/products_menu_list";
          const responseType = "json";

          xhr.responseType = responseType;
          xhr.open(method, url);
          xhr.onload = function(){
            const serverResponse = xhr.response;
            var res = serverResponse.response;
            var listed_products = res.product_list;

            // generating the menu list for the first time
            var generated_content= "";
            var i;
            for(i=0; i<listed_products.length; i++){              
              generated_content += listed_products[i].description;
              
            }
            generate_menu_list(listed_products); 

            // generating categories
            var listed_categories = res.categories;
            document.getElementById("food-cat-menu").innerHTML = generate_categories(listed_categories);

            // adding actions to buttons
            var cat_buttons = document.getElementsByClassName("btncats")
            for(var i = 0; i<cat_buttons.length; i++){
                var btn_id = cat_buttons[i].id;
                
                /*Actions taken after clicking on menu positions
                 filtering menu - positions based on categories */
                document.getElementById(btn_id).addEventListener("click", function(){
                  var new_menu_list = [];
                  
                  for(var j=0; j<listed_products.length; j++){                    
                    //Number of categories the product is in
                    num_cats_in = Object.keys(listed_products[j].category).length
                    
                    for(var c=0; c<num_cats_in; c++){
                      if (this.id === listed_products[j].category[c].category_name){
                        new_menu_list.push(listed_products[j]);
                      }
                    }
                  }
                  generate_menu_list(new_menu_list);
                })



            }
            
            
          }

          xhr.send();

        </script>
            
    </div>

    <div class="col-2 right-side-advert p-2 text-center">
        <h2>Advert</h2>
    </div>
</div>

{% endblock %}